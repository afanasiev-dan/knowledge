Библиотека TPL (Task Parallel Library) основана на концепции задач, представляющих длительные операции. Задача в .NET реализована классом `Task` из пространства имен `System.Threading.Tasks`. Такая задача может выполняться асинхронно в потоке из пула или синхронно в текущем потоке, но важно понимать, что задача – это не поток.


Три способа создания и запуска задачи:

```csharp
Task task1 = new Task(() => Console.WriteLine("Task1 is executed"));
task1.Start();
 
Task task2 = Task.Factory.StartNew(() => Console.WriteLine("Task2 is executed"));
 
Task task3 = Task.Run(() => Console.WriteLine("Task3 is executed"));
```

Так же, задачу можно запустить синхронно

```csharp
task1.RunSynchronously();
```

Или в продолжение другой задачи:

```csharp
Task task2 = task1.ContinueWith(t => Console.WriteLine($"Current Task: {Task.CurrentId}  Previous Task: {t.Id}"));
```

В случае задач продолжения (**continuation task**), метод `ContinueWith` принимает в качестве параметра делегат `Action<Task>`. Благодаря передаче в метод параметра Task, мы можем получить различные свойства предыдущей задачи, как например, в данном случае получаем ее Id.

### Ожидание завершения задачи

Чтобы приложение ожидало завершения задачи, можно использовать метод Wait() объекта Task:

```csharp
task1.Wait();
```

Стоит отметить, что метод Wait() блокирует вызывающий поток, в котором запущена задача, пока эта задача не завершит свое выполнение.


### Свойства класса Task

Класс Task имеет ряд свойств, с помощью которых мы можем получить информацию об объекте. Некоторые из них:

- AsyncState: возвращает объект состояния задачи
- CurrentId: возвращает идентификатор текущей задачи (статическое свойство)
- Id: возвращает идентификатор текущей задачи
- Exception: возвращает объект исключения, возникшего при выполнении задачи
- Status: возвращает статус задачи. Представляет перечисление `System.Threading.Tasks.TaskStatus`, которое имеет следующие значения:
    - `Canceled`: задача отменена
    - `Created`: задача создана, но еще не запущена
    - `Faulted`: в процессе работы задачи произошло исключение
    - `RanToCompletion`: задача успешно завершена
    - `Running`: задача запущена, но еще не завершена
    - `WaitingForActivation`: задача ожидает активации и постановки в график выполнения
    - `WaitingForChildrenToComplete`: задача завершена и теперь ожидает завершения прикрепленных к ней дочерних задач
    - `WaitingToRun`: задача поставлена в график выполнения, но еще не начала свое выполнение
- IsCompleted: возвращает true, если задача завершена
- IsCanceled: возвращает true, если задача была отменена
- IsFaulted: возвращает true, если задача завершилась при возникновении исключения
- IsCompletedSuccessfully: возвращает true, если задача завершилась успешно